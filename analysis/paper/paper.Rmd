---
title: "A simulation-based assessment of the relation between Stone Age sites and relative sea-level change along the Norwegian Skagerrak coast"
header-includes:
   - \usepackage{lineno}
   - \usepackage{afterpage}
   - \usepackage{fancyhdr}
   - \linenumbers
author: 
- 'Isak Roalkvam'
- 'University of Oslo, Institute of Archaeology, Conservation and History'
  # - Isak Roalkvam:
  #     email: isak.roalkvam@iakh.uio.no
  #     institute: [UiO]
  #     correspondence: true
# institute:
#   - UiO: University of Oslo, Institute of Archaeology, Conservation and History
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
    bookdown::pdf_document2:
      toc: false
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
      pandoc_args:
      # - --lua-filter=../templates/scholarly-metadata.lua
      # - --lua-filter=../templates/author-info-blocks.lua
      - --lua-filter=../templates/pagebreak.lua
bibliography: references.bib
csl: "../templates/saa.csl" # Insert path for the bib-style
abstract: |
  A central premise for the Stone Age archaeology of northern Scandinavia is that most coastal sites were located on or close to the contemporary shoreline when they were in use. By reconstructing the trajectory of rapid and continuous relative sea-level fall that characterises large regions of Fennoscandia, this offers a dating method termed 'shoreline dating' which is widely applied. However, while the potentially immense benefits of an additional source of temporal data separate from radiometric and typological methods is unquestionable, the geographical contingency and thus relative rarity of the method means that it has been under limited scrutiny compared to more established dating techniques in archaeology. This paper attempts to remedy this by quantifying the spatial relationship between Stone Age sites located below the marine limit and the prehistoric shoreline along the Norwegian Skagerrak coast. Monte Carlo simulation is employed to combine the uncertainty associated with independent temporal data on the use of the sites in the form of ^14^C-dates and the reconstruction of local shoreline displacement. The findings largely confirm previous hypotheses that sites older than the Late Neolithic tend to have been located on or close to the shoreline when they were occupied. Drawing on the quantitative nature of the results, a new and formalised method for the shoreline dating of sites in the region is proposed and compared to previous applications of the technique.
  
keywords: |
  Shoreline dating; Stone Age; Settlement patterns; Scandinavia; Relative sea-level change
---

<!--- Page numbers in margin to avoid conflict with figure captions --->
\fancypagestyle{plain}{%
  \fancyhf{}
  \fancyfoot[R]{\leavevmode\rlap{\thepage~}}
}
\pagestyle{plain}

## Highlights {-}

* Simulates the spatial relation between sites and the prehistoric shoreline
* Quantification of horizontal, topographic and vertical distance
* Confirms close association between sites and the contemporaneous shoreline
* Proposes a formalised method for the shoreline dating of pre-Late Neolithic sites

Keywords: `r rmarkdown::metadata$keywords`
```{r setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../figures/",
  fig.align = 'center',
  dpi = 300
)

knitr::opts_knit$set(
  eval.after = "fig.cap"
)
```

```{r libraries, eval = TRUE, results = 'hide'}
library(here)
library(tidyverse)
library(sf)
library(ggridges)
library(ggthemes)
library(ggnewscale)
library(patchwork)
library(terra)
library(raster)
library(oxcAAR)
library(vapour)
library(topoDistance)
library(IRanges)
library(stringr)
quickSetupOxcal()

# Set-up so that I can call floatbarrier using regfloat=TRUE in the chunk 
# headings. See: 
# https://gist.github.com/burchill/8873d2ade156b27e92a238a774ce2758
knitr::knit_hooks$set(plot = function (x, options) {
  float_correct <- function(f, y, opts)  {
    if (is.null(opts$regfloat) || opts$regfloat==FALSE)
      paste0(f(y, opts), "\n\n\\FloatBarrier\n")
    else
      f(y, opts)
  }
  if (!is.null(options$out.width) || !is.null(options$out.height) ||
      !is.null(options$out.extra) || options$fig.align != "default" ||
      !is.null(options$fig.subcap)) {
    if (is.null(options$fig.scap))
      options$fig.scap = NA
    return(float_correct(knitr:::hook_plot_tex, x, options))
  }
  return(float_correct(knitr:::hook_plot_md_base, x, options))
})
```

```{r get-data-functions, include = FALSE}
# Load all sites and radiocarbon data
sites <- read.csv(here('analysis/data/raw_data/sites.csv'))
rcarbon <- read.csv(here('analysis/data/raw_data/radiocarbon.csv'))

# Background map
bmap <- st_read(here('analysis/data/raw_data/naturalearth_countries.gpkg'))

# Point features with city names
cpts <- st_read(here('analysis/data/raw_data/central_points.gpkg'))

# Digital terrain model
dtm <- rast("/home/isak/phd/eaa_presentation/dtm10/dtm10.tif")

# Load processed site and radiocarbon data, and load functions
load(here("analysis/data/derived_data/01data.RData"))
load(here("analysis/data/derived_data/02data.RData"))
load(here("analysis/data/derived_data/06data.RData"))
load(here("analysis/data/derived_data/08agediff.RData"))
source(here("analysis/script/04functions.R"), local = knitr::knit_global())

# Exclude Lunaveien and Dybdalshei 2 (See supplementary material)
sites_sa <- filter(sites_sa, !(name %in% c("Dybdalshei 2", "Lunaveien")))

```

# Introduction

The post-glacial relative sea-level fall that characterises large areas of Fennoscandia is fundamental to its archaeology. This follows not only from the dramatic changes to the landscape that this process created throughout prehistory, but also from the fact that if archaeological phenomena were situated close to the contemporary shoreline when they were in use, a reconstruction of the trajectory of shoreline displacement can be used to date these phenomena based on their altitude relative to the present day sea-level. This method, also called shoreline dating, has long history of use in the region and is frequently applied to assign an approximate date to diverse archaeological phenomena such as rock art, grave cairns, various harbour and sea-side constructions and, as is the focus of this study, Stone Age sites [e.g. @akerlund1996; @bjerck2005; @gjerde2021; @loken1977; @nordqvist1995; @sognnes2003; @tallavaara2020; @schmitt2009; @wikell2009].

The close association between Stone Age settlements in the northern parts of Scandinavia and shifting prehistoric shorelines was proposed at the end of the 19th century [@degeer1896], and was first applied as a dating method at the turn of the century [@brogger1905; @hollender1901]. Shoreline dating has been fundamental to Norwegian Stone Age archaeology ever since [e.g. @berg-hansen2009; @bjerck2008; @johansen1963; @bjerck1990; @breivik2014; @olsen1984; @nummedal1923; @mikkelsen1975; @mjærum2022; @shetelig1922; @solheim2018]. The method is used both independently, and to compliment other sources of temporal data such as typological indicators or radiometric dates. However, given the coarse and fuzzy resolution of established typological frameworks, the vast number of surveyed sites that only contain generic lithic debitage that could hail from any part of the period, and as the conditions for the preservation of organic material is typically poor in Norway, dating with reference to shoreline displacement is often the only and most precise method by which one can hope to date the sites. Shoreline dating is consequently fundamental to our understanding of the Norwegian Stone Age. This is both because it is central to the temporal framework on which our understanding of the period is based, but also because the method is only applicable so long as the societies in question have continuously settled on or close to the contemporary shoreline. Consequently, adherence or deviation from this pattern also has major implications for the socio-economic foundations of the societies in question.

Despite its important role for Fennoscandian archaeology, the applicability of dating by reference to shoreline displacement has only been evaluated using relatively coarse methods. The aim of this paper is to provide a systematic and comprehensive review of the degree to which radiocarbon dates correspond with the dates informed by our current knowledge of shoreline displacement in a larger area of south-eastern Norway, using a more refined methodological approach. The goal here is to quantify the degree to which the assumption of shore-bound settlement holds through the Stone Age in a relatively well sampled portion of Scandinavia, and in turn have this quantification inform the development of a formalised method for shoreline dating. As presented in more detail below, this problem involves the combined evaluation of three major analytical dimensions. One is the questions of when the sites were in use, the second pertains to the reconstruction of the contemporaneous sea-level, and the third follows from the fact that the relation between site and shoreline is inherently spatial. Taking inspiration from studies that have integrated various sources of spatio-temporal uncertainty through Monte Carlo simulation [e.g. @bevan2013a; @crema2012; @crema2010; @crema2015; @yubero-gomez2016], a similar approach is adopted here and adapted to the parameters of post-glacial sea-level change and the Stone Age settlement of southern Norway.

# Background

Relative sea-level (RSL) can be defined as the mean elevation of the surface of the sea relative to land, or, more formally, the difference in elevation between the geoid and the surface of the Earth as measured from the Earth's centre [@shennan2015]. Variation in this relative distance follow from a range of effects [e.g. @milne2009]. Of central importance here is eustasy and isostasy. Eustatic sea-level is understood to be the sea-level if the water has been evenly distributed across the Earth's surface without adjusting for variation in the rigidity of the Earth, its rotation, or the self-gravitation inherent to the water body itself [@shennan2015]. The eustatic sea-level is mainly impacted by glaciation and de-glaciation, which can bind or release large amounts of water into the oceans [@mörner1976]. Isostasy, on the other hand, pertains to adjustments in the crust to regain gravitational equilibrium relative to the underlying viscous mantle caused by mass loading and unloading, which occurs with glaciation and deglaciation. These effects causes the lithosphere to either subside due to increased weight, or to rebound and lift upwards due to lower weight [@milne2015].

Following the end of the Weichselian and the final retreat of the Fennoscandian Ice Sheet [e.g. @hughes2016; @stroeven2016, see Figure \@ref(fig:deglaciation)], the isostatic rebound has caused most areas of Norway to have been subjected to a continuous relative sea-level regression, despite corresponding eustatic sea-level rise [e.g. @mörner1979; @svendsen1987]. In other words, the RSL has been dropping throughout prehistory. As this process is the result of glacial loading, the rate of uplift is faster towards the centre of the ice sheet relative to the distal aspects. Thus, there is differential glacio-isostatic impact to a site’s location depending on it's relation to the ice sheet’s centre of mass, leading some areas on the outer coast to have had a more stable RSL or been subject to marine transgression [e.g. @romundset2015; @svendsen1987]. These conditions are directly reflected in the archaeological record. In areas where the sea-level has been stable over longer periods of time, people have often reused coastal site locations multiple times and over long time spans, creating a mix of settlement phases that are difficult to disentangle [e.g. @hagen1963; @reitan2009]. Transgression phases, on the other hand, can lead to complete destruction of the sites, bury them in marine sediments, or in the outermost periphery, submerge them [@bjerck2008; @glorstad2020]. Transgression can therefore lead to a hiatus in the archaeological record for certain sub-phases in the impacted areas despite the fact that there were likely coastal settlements during the inferred hiatuses. Comparatively, given a continuous and still ongoing shoreline regression from as high as c. 220m above present sea-level in the inner Oslo fjord, any one location in south-eastern Norway has only been shore-bound within a relatively limited time span, and the sites have not been impacted by any transgressions [@hafsten1957; @hafsten1983; @romundset2018; @sørensen1979]. This makes the region especially useful for evaluating the assumption of a shore-bound settlement pattern over a long and continuous time span.

```{r deglaciation, echo = FALSE, fig.cap = "Deglaciation at 1000 year intervals from c. 17--8 thousand years (kyr) BCE. The study area defined later in the text is marked with a red outline (deglaciation data from Hughes et al. 2016, but see also Romundset et al. 2019 in relation to the study area).", out.width = "525px", fig.align = "center", regfloat = TRUE}

# This map was pre-compiled for convenience. The deglaciation data from DATED-1 
# Hughes et al. 2015 is available as supplemental material to their paper:
# https://doi.org/10.1111/bor.12142
knitr::include_graphics(here("analysis/figures/deglaciation.png"))

```

The method of shoreline dating has been met with scepticism as related to the fundamental premise that most sites would have been consistently shore-bound, it has been characterised as a relative dating method for sites located within a constrained geographical area, or it has been argued to offer no more than an earliest possible date for when a site could have been in use [see review by @nordqvist1999]. The most common application in Norway has arguably been to use shoreline dating to provide an approximate date for the occupation of the sites, often in combination with other dating methods [see for example chapters in @glorstad2002; @glorstad2003; @glorstad2004; @jaksland2001; @jaksland2012; @jaksland2012a; @jaksland2014a; @reitan2014l; @melvold2014b; @reitan2018c; @solheim2017b and below]. Recently the method has also been used independently to date a larger number sites to get a general impression of site frequency over time. This is done by aggregating point estimates of shoreline dates in 100-, 200- or 500-year bins [@breivik2014; @breivik2018a; @solheim2018; @fossum2020; @mjærum2022; @nielsen2021b; see also @jorgensen2020; @tallavaara2020]. In his review, @nordqvist1999 argues that there can be little doubt concerning the general applicability of the method---what is less clear is the level of reliability and chronological resolution that it can offer [see also @johansen1963; @johansen1997; @mikkelsen1975a, 100].

The shore-bound settlement location of prehistoric hunter-fisher-gatherers in Norway is generally believed to follow both from the exploitation of aquatic resources and from movement and communication, which would have been efficient on waterways [@brogger1905, 166; @bjerck1990; @bjerck2017; also discussed by @berg-hansen2009; @bergsvik2009]. The same logic has also been extended to the hinterland and inland regions, where sites are believed to be predominantly located along rivers and lakes [@brogger1905, 166; @glorstad2010, 57--87; but see also @gundersen2013; @mjærum2018; @schulke2020]. This is to take a dramatic turn at the transition to the Late Neolithic, around 2400 BCE, with the introduction of the Neolithic proper [@prescott2020; cf. @solheim2021]. The introduction of a comprehensive Neolithic cultural package, including a shift to agro-pastoralism and the development of settled farmsteads is to have led site locations to be more withdrawn from the shoreline [e.g. @bakka1971; @prescott2020; @ostmo2008, 223]. That is not to say that waterways and aquatic resources were no longer exploited, but rather that these activities would not have been as tightly integrated with settlement and tool-production areas as in preceding periods [@glorstad2012]. At an earlier stage, at the transition to the Early Neolithic (c. 3900 BCE), pottery is introduced to the sites, and there are some indications of an initial uptake of agriculture at some sites in the Oslo fjord region. However, this appears to be small in scale and is believed to be combined with a continued and predominantly hunter-gatherer life-way, possibly followed by a return to foraging and complete de-Neolithisation in the Middle Neolithic [@nielsen2019; @hinsch1955; @ostmo1988, 225--227]. @nielsen2021b has recently argued that the initial uptake of agriculture in Early Neolithic south-eastern Norway is combined with a more complex settlement pattern, and that a simple foraging/agricultural dichotomy would underplay the variation present in the Early and Middle Neolithic settlement data [see also e.g. @amundsen2006; @solheim2012, 74; @ostmo1988]. Seen in relation to the question of interest here, the empirical expectation for the above outlined development would thus be a predominantly shore-bound settlement in the Mesolithic, possibly followed by a more varied association between sites and the shore-line with the transition to the Early Neolithic around 3900 BCE, and finally a decisive shift with the Late Neolithic c. 2400 BCE.

Based on the generally accepted premise that most pre-Late Neolithic sites in south-eastern Norway located lower than the marine limit (the highest elevation of the sea after the retreat of the ice) were situated on or close to the contemporaneous shoreline, it is common to err on the side of a shore-bound site location unless there is strong evidence to suggest otherwise. This is for example reflected in archaeological survey practices, which are often guided by both a digital and mental reconstruction of past sea-levels [see e.g. @berg-hansen2009; @eskeland2017; @nummedal1923; @simpson2009]. Similarly, following an excavation, if typological indicators in the assemblages correspond with available shoreline displacement curves, a shore-bound site location is often assumed, even if the typologically informed date span is too wide to decisively verify this. It is also common to combine this with a qualitative consideration of the landscape surrounding the sites, and an evaluation of the degree to which the site location would appear to have been sensible if the site was not shore bound [e.g. @jaksland2014; @johansen1963; @nummedal1923]. This can for example pertain to accessibility. If the site is situated on a ledge in a steep and jagged area of the present-day landscape it would make intuitive sense that the site was in use when the ocean reached closer to its elevation, as the site would have been accessible by means of watercraft. Although it appears that the arguments for such site locations can for the most part be assumed to hold, comprehensive evaluations and attempts at quantification of this tendency are relatively few [see also @ilves2011].

One of the more extensive evaluations of the relationship between archaeological radiocarbon dates and RSL-change was done by Solheim and colleagues [@breivik2018; @solheim2020], who compared 102 radiocarbon dates from 29 Mesolithic sites on the western side of the Oslo fjord to the displacement curve for the Larvik area. They found an overlap between the probability distribution of the radiocarbon dates with the shoreline displacement curve for 86.3% of the dates [@solheim2020, 48] . However, where there was a discrepancy, the main occupation of the sites are still believed to have been shore-bound rather than associated with the deviating ^14^C-dates. This is based on typological and technological characteristics of the assemblages. Whether these mismatches represent later shorter visits that are responsible for the younger radiocarbon dates, or whether these dates are entirely erroneous can be difficult to evaluate [e.g. @persson2008; @schulke2020]. However, this distinction is not deemed critical here, as what is of interest is settlements and tool-production areas as evidenced by artefact inventories or multiple site features. Not remnants of stays as ephemeral to only be discernible by isolated features or dubious ^14^C-dates. The evaluation of the relevance of radiocarbon dates to settlement activity will here therefore be entirely dependent upon, and follow the discretion of the original excavation reports.

Other previous evaluations of the correspondence between radiocarbon- and RSL-informed dates have typically followed the same structure as that of @breivik2018, involving a visual inspection of radiocarbon probability density functions plotted against local shoreline displacement curves based on the elevation of the site [e.g. @akerlund1995; @åstveit2018; @solheim2020; see also @bjerck2008a; @kleppe1985; @ramstad2009]. This approach has a couple of limitations. First, the displacement curves are sometimes applied directly to larger study areas, analogous to what @borreggine2022 term a bathtub model, with only some studies having taken the variable uplift-rates into account when performing this comparison [e.g. @åstveit2018; @fossum2020; @møller1987; @persson2008]. Secondly, with this method, the wider the uncertainty range associated with either radiocarbon date or displacement curve, the higher the probability that the confidence intervals overlap, and the higher the probability that the conclusion supports the hypothesis. This thus leads to an inferential framework that favours uncertainty, which is hardly desirable. In statistical terms this follows from the fact that while one cannot conclude that two dates are different if their confidence intervals overlap, this does not necessarily mean that they are the same. The question thus necessitates a flip from a null-hypothesis of no significant difference, to one of equivalence [e.g. @lakens2018], as the question of interest is effectively one of synchroneity between events [cf. @parnell2008]. Another limitation of this often-employed method is that it only takes into account the vertical distance between the sites and the sea-level. While this is the main parameter of interest for shoreline dating, the practical implications of a vertical difference in RSL will be highly dependent on local topography and bathymetry. RSL-change can have more dramatic consequences in a landscape characterised by a low relief, as the horizontal displacement of the shoreline will be greater. Taking the spatial nature of the relationship between site and shoreline into account will consequently help get more directly at the behavioural dimension of this relation and help move the analysis beyond a purely instrumental consideration of the applicability of shoreline dating. 

# Data
To get at the relationship between sites and the contemporaneous shoreline, this analysis was dependent on identifying a study area with good control of the trajectory of prehistoric shoreline displacement. While there is displacement data available for other areas of south-eastern Norway [e.g. @hafsten1957; @sørensen1979; @sørensen1999], considerable methodological developments in recent years means that the most well-established displacement curves are from the region stretching from Horten county in the north-east, to Arendal in the south-west (Figure \@ref(fig:map-iso)). This area has newly compiled displacement curves for Skoppum in Horten [@romundset2021], Gunnarsrød in Porsgrunn [@sørensen2014; @sørensen2014b; @sorensen2023], Hanto in Tvedestrand [@romundset2018; @romundset2018b], and Bjørnebu in Arendal [@romundset2018b].

The shoreline displacement data used in this study are based on the so-called isolation basin method [e.g. @kjemperud1986; @romundset2011], which involves extracting cores from a series of basins situated on bedrock at different elevations beneath the marine limit, and dating the transition from marine to lacustrine sediments. Each basin thus represents a high precision sea-level index point (SLIP) which are combined in a continuous time series for RSL-change adjusted to a common shoreline isobase. The isobases are here contours indicating equal shoreline displacement over the same time span [@svendsen1987, 116]. To minimise the impact of variable uplift rates, the cored basins are located in as constrained of an area of the landscape as possible. Following from the morphology of the retreating ice sheet, the uplift is more stark towards the north-east, which needs to be adjusted for in the case that any basins are located any significant distance from the common isobase that runs perpendicular to this uplift gradient (Figure \@ref(fig:map-iso)). Furthermore, as the uplift has been greater immediately following the retreat of the ice, such adjustments, and thus potential uncertainty, will be more critical further back in time. The resulting SLIPs are most commonly interpreted as representing the isolation of the basins from the highest astronomical tide, which is adjusted to mean sea-level in the compilation of the displacement curves, based on the present-day tidal range. For simplicity, the tidal range is assumed to have been the same throughout the Holocene [@sørensen2014, 44]. The highest astronomical tide in the study area reaches around 30cm above mean sea-level [@mapping2021; 30cm at the standard port Helgeroa in Larvik]. Furthermore, the confidence bands of the displacement curves and their trajectory are quite complex constructs as they are the integrated result of both expert knowledge and more objectively quantifiable parameters. The reason for this is that the curves do not only contain uncertainty as related to radiometric dates, which are well defined, but they are for example also dependent on the interpretation and analysis of sediment cores, the nature and condition of the basin outlets and the adjustment to a common isobase, as well as being based on expert knowledge of regional post-glacial geologic developments and local geomorphology, to name but a few factors [e.g. @romundset2011; @romundset2018; @svendsen1987; for an alternative approach see @creel2022]. For more details and evaluations done for the compilation of each curve, the reader is therefore referred to the individual publications.


The archaeological data compiled for the analysis consists of excavated Stone Age sites with available spatial data from the coastal region between Horten county in the north-east, to Arendal in the south-west (Figure \@ref(fig:map-iso)). These number `r nrow(sites)` sites of which `r length(unique(rcarbon$site_name))` sites are associated with a total of `r nrow(rcarbon)` radiocarbon dates. Of these, in turn, `r nrow(sites_sa)` sites are related to the `r nrow(rcarb_sa)` radiocarbon date ranges that intersect the Stone Age (9500--1700 BCE), with 95% probability. These sites and ^14^C-dates form the basis for the analysis. Spatial data in the form of site limits and features, as defined by the excavating archaeologists, were retrieved from local databases at the Museum of Cultural History of the University of Oslo---the institution responsible for archaeological excavations and data curation in the region. In the compiled dataset, each radiocarbon date has been associated with the site features or excavation unit from where they originate, or, where these weren't available, the spatial limit of the entire site. Due to somewhat variable practices between excavations, what available spatial geometry best represents the site limit was decided based on an evaluation of the excavation reports. This means that the limits are variably given as that defined during initial survey, area de-turfed before excavation, area stripped with excavator following the excavation, manually excavated area, or convex hull polygons generated around the site features.

Three of the sites have been associated with agriculture, either directly or in the form building structures. The first is Nordby 1 at which the ^14^C-dates are associated with a Late Neolithic long-house [@gjerpe2008b]. The Middle Neolithic phase at Kvastad A2 [@stokke2018b] and Late Neolithic phase at Nauen A [@persson2008] are both directly related to farming activities. Both of these sites also have radiocarbon dates and lithic inventory associated with Mesolithic forager activities. Following from the expected deviance from the settlement patterns that are to characterise forager sites, these agricultural phases are highlighted in the analysis below. Finally, @nielsen2021b has recently suggested that Early and Middle Neolithic features from the otherwise younger sites Bratsberg [@wenn2012] and Larønningen [@roberg2012] could be related to early agricultural activity in the Oslo fjord region. Due to the uncertain and somewhat speculative nature of this suggestion, these are omitted here.

The elevation data used for the analysis is a digital terrain model (DTM) freely available from the Norwegian Mapping Authority [@mapping2018, https://hoydedata.no]. The 10m resolution DTM was used rather than the higher-resolution 1m version, both because this resulted in considerably less processing time and because the higher resolution elevation model is more vulnerable to smaller-scale modern disturbances. The 10m resolution DTM of the study area is a down-sampled version of the 1m version and has a height accuracy with a systematic error of 0.1m [@mapping2018]. All data and R programming code [@rcoreteam2021] required to run the analyses, as well as the derived data are freely available in an online repository at <https://osf.io/7f9su/>, organised as a research compendium following @marwick2018.

```{r map-iso,  fig.cap = paste("A) Location of the study area and the distribution of the ", nrow(sites_sa), " analysed sites relative to the isobases of the displacement curves. The isobases have a direction of 327$^{\\circ}$ (Romundset et al. 2018, although see Sørensen et al. 2014), B) Displacement curves. Note the increasing steepness of the curves towards the north-east."), fig.height = 13, fig.width = 12, regfloat=TRUE}
# To make sure labelling ends up the same every knit.
set.seed(1)

# Create a bounding box around site points to limit the overview map.
sitbbox <- st_bbox(sites_sa)
sitbbox[1:2] <- sitbbox[1:2] - 100000
sitbbox[3:4] <- sitbbox[3:4] + 100000
boundingpoly <- st_as_sf(st_as_sfc(sitbbox))

# Reproject the bounding box to match world map, and crop the world map
# with the bounding box polygon.
bound_reproj <- st_transform(boundingpoly, st_crs(bmap))
mapcountries <- bmap %>% 
  filter(st_intersects(., bound_reproj, sparse = FALSE))
count_reproj <- st_transform(mapcountries, st_crs(sites_sa))

bboxsites <- st_bbox(sites_sa)
bboxsites[1] <- bboxsites[1] - 15000
bboxsites[3] <- bboxsites[3] + 15000
bboxsites[2] <- bboxsites[2] - 5000
bboxsites[4] <- bboxsites[4] + 5000
bboxsitespoly <- st_as_sf(st_as_sfc(bboxsites))

overview <-
  ggplot() +
  geom_sf(data = count_reproj, fill = "grey", colour = NA) +
  geom_sf(data = bboxsitespoly,
          fill = NA, colour = "red", size = 0.25) +
  geom_sf(data = cpts) +
   ggrepel::geom_text_repel(
    data = cpts,
    aes(label = NAME, geometry = geom),
    stat = "sf_coordinates",
    min.segment.length = 0,
    size = 4) +
  coord_sf(xlim = c(sitbbox[1], sitbbox[3]), ylim = c(sitbbox[2], sitbbox[4]),
         expand = FALSE) +
  labs(title = "A") +
  theme_bw() + theme(axis.title=element_blank(),
                     axis.text.y = element_blank(),
                     axis.text.x = element_blank(),
                     rect = element_rect(),
                     axis.ticks = element_blank(),
                     panel.grid.major = element_blank())

bound_reproj <- st_transform(bboxsitespoly, st_crs(bmap))
bmap2 <- bmap %>%
    filter(st_intersects(., bound_reproj, sparse = FALSE))
bmap_reproj <- st_transform(bmap2, st_crs(sites_sa))

anc <- as.numeric(c(bboxsites$ymin, bboxsites$xmax))
site_map <- ggplot() +
  geom_sf(data = bmap_reproj, fill = "grey", colour = NA) +
  geom_sf(data = isobases, aes(colour = name)) +
  geom_sf(data = st_centroid(sites_sa), fill = "red",
          size = 2.25, shape = 21,
          colour = "black") +
  ggsn::scalebar(data = sites_sa, dist = 20, dist_unit = "km",
                 transform = FALSE, st.size = 4, height = 0.02,
                 border.size = 0.1, st.dist = 0.03,
                 anchor = c(x = anc[2] - 15500, y = anc[1]) + 8000) +
  coord_sf(xlim = c(bboxsites[1], bboxsites[3]),
           ylim = c(bboxsites[2], bboxsites[4]),
           expand = FALSE) +
  scale_colour_manual(values = c("Arendal" = "black",
                                   "Larvik" = "darkgreen",
                                   "Tvedestrand" = "blue",
                                   "Horten" = "darkorange")) +
  theme_bw() + theme(axis.title=element_blank(),
                     axis.text.y = element_blank(),
                     axis.text.x = element_blank(),
                     rect = element_rect(),
                     axis.ticks = element_blank(),
                     panel.grid.major = element_blank(),
                     legend.position = "none") 

# Rename to use the precise placenames
rname_disp <- displacement_curves
rname_disp$name <- ifelse(displacement_curves$name == "Larvik",
                                   "Gunnarsrød", 
                                   ifelse(
                                     displacement_curves$name == "Tvedestrand",
                                     "Hanto", 
                                     ifelse(
                                       displacement_curves$name == "Arendal",
                                       "Bjørnebu", "Skoppum")))

disp_curves <- ggplot(rname_disp, aes(x = years, col = name)) +
  geom_line(aes(y =  upperelev)) +
  geom_line(aes(y = lowerelev)) +
  labs(title = "B", y = "Meters above present sea-level", x = "BCE/CE") +
  scale_colour_manual(values = c("Skoppum" = "darkorange",
                                 "Gunnarsrød" = "darkgreen",
                                 "Hanto" = "blue",
                                 "Bjørnebu" = "black")) +
  theme_bw() +
  theme(legend.title = element_blank(), legend.position = "bottom",
        legend.direction = "horizontal")


(overview + site_map) /
(disp_curves + theme(plot.margin = unit(c(0,135,0,135), "pt")))
```

# Methods

Shoreline dating is based on the spatial relationship between two phenomena, occupation of sites and shoreline displacement, each associated with temporal uncertainty. The first task was therefore to ascribe a likely date and associated degree of uncertainty to these dimensions. To take account of the gradient in the isostatic rebound, the trajectory of shoreline displacement was first interpolated to each site location based on the distance to the isobases of the displacement curves, using inverse distance weighting [e.g. @conolly2020; @conolly2006, 94--97]. This was done for each year along the entirety of the curves, weighting the interpolation by the squared inverse of the distances. The result of this process is shown for an example site in Figure \@ref(fig:example-1). For the sites all radiocarbon dates were first individually calibrated using the IntCal20 calibration curve [@reimer2020] using OxCal v4.4.4 [@bronkramsey2009] through the oxcAAR package for R [@hinz2021]. Radiocarbon dates associated with each site were then grouped if their date ranges intersected at 99.7% probability, meaning these were effectively taken to be associated with the same event, here termed settlement or site phase. In the case where there are multiple dates believed to belong to a single settlement phase, these were modelled using the Boundary function in OxCal and then summed using the Sum function. Multiple phases at a single site were treated as independent of each other.

The excavation of archaeological sites in Norway typically occur in advance of residential and commercial infrastructure development. As the data collection for the utilised DTM was begun by the Norwegian Mapping Authority in 2016, the area of the DTM immediately surrounding the sites has sometimes been severely impacted by disturbances after the excavation. In addition to employing the 10m resolution DTM to alleviate some of these issues, this also necessitated some additional editing of the elevation raster. This involved manually defining the extent of problem areas such as railways, highways, quarries and the like. The DTM values on these were then set to missing, and new elevation values were interpolated from the surrounding terrain. This was done using regularised spline interpolation with tension [e.g. @conolly2020], using the default settings of r.fillnulls from GRASS GIS [@grass2017] in R through the package rgrass7 [@bivand2021]. In addition to code and original spatial data being available in the online repository for the paper, the location and analysis of each individual site is presented in the supplementary material where it has been noted when the area surrounding a site has been edited in this manner.

Armed with a likely date range for the occupation(s) of each site, an estimated trajectory of RSL change at that location, and a DTM edited to remove substantial modern disturbances, the simulations were performed. A single simulation run involved first drawing a single year from the posterior density estimate of a given occupation phase of a site (Figure \@ref(fig:example-2)). This year then has a corresponding likely elevation range for the contemporaneous shoreline from which an elevation value was drawn uniformly, using intervals of 5cm. The sea-level was then raised to this elevation on the DTM by defining all elevation values at or below this altitude as missing. Polygons were then created from the resulting areas with missing values. The horizontal distance was then found by measuring the shortest distance between site and sea polygons, and the vertical distance by subtracting the elevation of the sea-level from the lowest elevation of the site polygon. The topographic distance between site and sea was also found by measuring the distance while taking into account the slope of the terrain on the DTM. This was done using the topoDistance package for R [@wang2019]. The topographic distance was measured between the site polygon and the horizontally closest point on the shoreline. This means that the distance is not necessarily measured as the closest topographic distance to the shoreline, but rather as the shortest topographic path to the horizontally closest point on the shoreline. Not finding the topographically closest point significantly reduced the computational cost of the analysis, and is deemed unlikely to have a considerable impact on the results given the distances considered. The shortest topographic path was found using the Moore neighbourhood of eight cells [e.g. @conolly2006, 253; @herzog2013]. In the case where the sea polygons intersect the site polygon, all distance measures were set to zero. In the case that the sea polygons completely contain the site, the horizontal and topographic distance measures were made negative, and the vertical distance was instead measured to the highest point on the site polygon. While it is safe to assume that an archaeological site was not occupied when it was located beneath sea-level, a negative result can reflect the inherent uncertainty in this procedure, and might also help identify discrepancies in displacement data or radiocarbon dates. Negative values were therefore retained with the exception of the sites of Gunnarsrød 5 and Pjonkerød R1, where the negative values are believed to result from modern disturbances in the DTM rather than the ^14^C-dates or displacement curves (see supplementary material for more details).

This process was repeated 1000 times for each phase for each site. The choice of 1000 simulation runs follows from an evaluation of when the mean distances between site and shoreline converged when running 5000 iterations of the simulation on the site Hovland 5, available in the supplementary material [cf. @crema2010, 1125]. Hovland 5 was chosen for this evaluation as it has an imprecise age and is located in area of quite complex topography. 

```{r example-site, fig.show='hide'}
# Specify site name
sitename <- "Hegna vest 1"

# Group dates that overlap with 99.7 % probability using the group_dates()
# function. (bespoke functions are defined in 04script.R).
date_groups <- group_dates(rcarb_sa, sitename)

# Retrieve site limit and site features
siter <- dplyr::filter(rcarb_sa, site_name == sitename)
sitel <- dplyr::filter(sites_sa, name == sitename)

# Creating bounding box at 400 meters
location_bbox <- bboxpoly(sitel, 400)

# Clip DTM with the bbox
sitearea <- terra::crop(dtm, location_bbox)

# Model dates using the Boundary function in OxCal
datedat <- model_dates(sitedates = siter, date_groups = date_groups)

# Find local displacement curve
sitecurve <- interpolate_curve(years = xvals,
                                 target = sitel,
                                 dispdat = displacement_curves,
                                 isodat = isobases)
# Add site name
sitecurve$name <- sitename

# Plot of dates
date_plot <- plot_dates(datedat, sitename, title = FALSE)
site_map <- site_plot(sitearea, sitel, 150, date_groups,
                      s_tdist = 0.5, s_xpos = 175,
                       s_ypos = 85,  s_bheight = 0.3, s_tsize = 3)
overview_map <- overview_plot(bmap, sitel, sites_sa, isobases,
                               os_tdist = 0.03, os_xpos = 20000, os_ypos = 8000,
                               os_bheight = 0.02, os_tsize = 3)

curve_plot <- ggplot2::ggplot() + 
              geom_line(data = rname_disp, 
                      aes(x = years, y = upperelev, col = name), alpha = 0.4) +
  geom_line(data =  rname_disp, 
                      aes(x = years, y = lowerelev, col = name), alpha = 0.4) +
  geom_line(data = sitecurve,
            aes(x = years, y = upperelev, col = name)) +
  geom_line(data = sitecurve,
            aes(x = years, y = lowerelev, col = name)) +
  scale_colour_manual(values = c("Skoppum" = "darkorange",
                                 "Gunnarsrød" = "darkgreen",
                                 "Hanto" = "blue",
                                 "Bjørnebu" = "black",
                                 "Hegna vest 1" = "red")) +
  ylab("Meters above present sea-level") +
  xlab("BCE/CE") +
  theme_bw() +
  theme(legend.title = element_blank(), legend.position = "bottom",
        legend.direction = "horizontal")


plt <- (site_map + date_plot) /
(overview_map + curve_plot) +
  plot_annotation(tag_levels = 'A')

# It was easier to get correct dimensions by saving and then 
ggsave(file = here("analysis/figures/example_map.png"), plot = plt, width = 250,
       height = 76 + (76 * length(unique(date_groups))),
       units = "mm")

```

```{r example-1, echo = FALSE, fig.cap = "Example site Hegna vest 1 (Fossum 2017). A) Location of the site on the edited 10m resolution DTM. The red outline is the site limit. B) Radiocarbon dates associated with the site. Fill colour indicates what dates are assumed to belong to the same settlement phase. Multiple dates are modelled using the Boundary function in OxCal and then summed. The red outline indicates that the date does not match the typological indicators in the artefact assemblage of the site. C) The location of the site within the study area relative to isobases of the displacement curves. D) Displacement curve interpolated to the site location.", out.width = "500px", fig.align="center", regfloat=TRUE}
knitr::include_graphics(here("analysis/figures/example_map.png"))
```

```{r example-site-cont2, fig.show='hide'}
# For reproducibility
set.seed(1)

# Retrieve example date to be used. The posterior sum of date group 1
posteriorprobs <- filter(datedat, group == 1 & class == "sum")

# Set up to sample a single year
samplingframe <- list(x = posteriorprobs[["dates"]],
                      y = posteriorprobs[["probabilities"]])

# Draw a single year
sdate <- round(with(samplingframe, sample(x, size = 1, prob = y)))

# Create plot showing the year drawn from the posterior sum
datsamp <- ggplot(posteriorprobs) +
  ggridges::geom_ridgeline(aes(x = dates, y = name,
                               height = probabilities * 50),
                           fill = "lightgrey") +
  # Create segment to indicate which year was drawn
  geom_segment(aes(x = sdate, xend = sdate, y = as.numeric(as.factor(name)),
                   yend = as.numeric(as.factor(name)) +
                     (posteriorprobs[round(dates) == sdate,
                                     "probabilities"]) * 50),
               colour = "red") +
  labs(x = "BCE")  +
  #scale_y_discrete(expand = c(0.01, 0)) +
  theme_bw() + theme(
    legend.position = "none",
    axis.title.y = element_blank(),
    axis.ticks.y = element_blank()
  ) +
  scale_x_continuous(breaks = sort(c(-8200, -8000, sdate, -7600)))

# Find upper and lower shoreline elevation at sdate
uppers <- round(approx(sitecurve[,"years"], sitecurve[,"upperelev"],
                       xout = sdate)[["y"]], 1)
lowers <- round(approx(sitecurve[,"years"], sitecurve[,"lowerelev"],
                       xout = sdate)[["y"]], 1)

# Draw sea-level uniformly from elevation range, intervals of 5 cm
sealevel <- sample(seq(lowers, uppers, 0.05), 1)

# Plot the drawn elevation on the displacement curve
elevsamp <- ggplot(sitecurve, aes(x = years)) +
  geom_line(aes(y =  upperelev), colour = "red") +
  geom_line(aes(y = lowerelev), colour = "red") +
  ylab("Meters above present sea-level") +
  xlab("BCE/CE") +
  theme_bw() +
  theme(legend.title = element_blank(), legend.position = "bottom",
        legend.direction = "horizontal") +
  geom_segment(aes(x = sdate, xend = sdate, y = uppers,
                                           yend = -Inf), col = "black",
                size = 0.25, linetype = "solid") +
  geom_segment(aes(x = -Inf, xend = sdate, y = uppers,
                   yend = uppers), col = "black", size = 0.25) +
  geom_segment(aes(x = -Inf, xend = sdate, y = lowers,
                   yend = lowers), col = "black", size = 0.25) +
  geom_segment(aes(x = -Inf, xend = sdate, y = lowers,
                   yend = lowers), col = "black", size = 0.25) +
  geom_segment(aes(x = -Inf, xend = sdate, y = sealevel,
                   yend = sealevel), col = "red", size = 0.25,
               linetype = "dashed") +
  annotate("text", x = -8700, y = uppers + 3.5, label = as.character(uppers)) +
  annotate("text", x = -8700, y = lowers - 3.5, label = as.character(lowers)) +
  scale_x_continuous(breaks = sort(c(sdate, -6000, -3000, 0))) +
  scale_y_continuous(breaks = sort(c(0, sealevel, 100)))

# Adjust sea-level on DTM
rclmat <- matrix(c(sealevel, Inf, NA, 0, sealevel, 1),
                 ncol = 3, byrow = TRUE)
classarea <- terra::classify(sitearea, rclmat)
seapoly <- st_combine(st_as_sf(terra::as.polygons(classarea)))


# Retrieve lowest elevation on polygon
siteelev <- extract(sitearea, vect(sitel), fun = min)[2]
# Find difference to sea-level elevation
vertdist <-  min(siteelev[1:nrow(siteelev),]) - sealevel

# Find the nearest points on the site- and seapolygons,
distline <- st_nearest_points(sitel, seapoly)

# Retrieve the two points
distpts <- st_cast(distline, "POINT")

# Find topographic distance
coords <- rbind(st_coordinates(distpts[1]),
                st_coordinates(distpts[2]))
rownames(coords) <- c("loc", "sea")

# Find topographic distance (retrieve path)
topodist <- topoDist(raster::raster(sitearea), coords,
                     paths = TRUE)
# Store distance
tdist <- topodist[[1]]["loc", "sea"]

# Retrieve path
tpath <- st_as_sf(topodist[[2]])

# Find end-points
endptns <- st_line_sample(tpath, sample = c(0, 1))

# Cast as line
hordistl <- st_cast(endptns, "LINESTRING")

# Find horizontal distance
hordist <- st_length(hordistl)

# Create hillshade
# For some reason the terra version returned pathchy hillshade (probably due 
# to the defaults - I didn't bother experimenting too much as this is simply for
# the purposes of visualisation).
slope <- raster::terrain(raster(sitearea), 'slope')
aspect <- raster::terrain(raster(sitearea), 'aspect')
hill <- raster::hillShade(slope, aspect, 40, 270)

# Make the raster amenable for plotting with ggplot (as.data.frame with terra
# returned some strange errors)
raster_df <- raster::as.data.frame(raster(sitearea), xy = TRUE)
names(raster_df) <- c("x", "y", "value")

# Anchor for scale bar
anc <- as.numeric(c(st_bbox(location_bbox)$ymin, st_bbox(location_bbox)$xmax))

# Create plot showing single simulation of sea-level
seasamp <- ggplot() +
  geom_raster(data = raster::as.data.frame(hill, xy = TRUE),
                aes(x = x, y = y, fill = layer)) +
  scale_fill_gradient(low = "black", high = "grey40", na.value = NA) +
  new_scale_fill() +
  geom_raster(data = raster_df, aes(x = x, y = y, fill = value),
                alpha = 0.3) +
  scale_fill_gradient(low = "grey", high = "white", na.value = NA) +
  new_scale_fill() +
  geom_raster(data = raster_df, aes(x = x, y = y, fill = value)) +
  scale_fill_gradient(low = NA, high = NA, na.value = "white") +
  geom_sf(data = seapoly, fill = "#dbe3f3", colour = NA) +
  geom_sf(data = sitel, fill = NA, colour = "red") +
  #labs(title =  paste0("Sea-level at ", sealevel, " m above present")) +
  coord_sf(xlim = c(st_bbox(location_bbox)[1], st_bbox(location_bbox)[3]),
           ylim = c(st_bbox(location_bbox)[2], st_bbox(location_bbox)[4]),
           expand = FALSE) +
  ggsn::scalebar(data = sitel, dist = 150, dist_unit = "m",
                 transform = FALSE, st.size = 3, height = 0.3,
                 border.size = 0.1, st.dist = 0.5,
                 anchor = c(x = anc[2] - 500, y = anc[1] + 800)) +
  theme_bw() + theme(axis.title=element_blank(),
                     axis.text.y = element_blank(),
                     axis.text.x = element_blank(),
                     rect = element_rect(),
                     axis.ticks = element_blank(),
                     panel.grid.major = element_blank(),
                     legend.position = "none")

# Create label of distance measures
dist_label <- paste0("Horizontal distance = ", round(hordist, 1), "m", 
                "\nTopographic distance = ", round(tdist, 1), "m",
                "\nVertical distance = ", round(vertdist, 1), "m")

anot <- ggplot() +
  theme_void() +
  annotate("text", x = 0,  y = 0, label = dist_label,
           hjust = 0.5, size = 7)

simplot <- (datsamp + elevsamp) / 
  (seasamp + anot) + plot_annotation(tag_levels = 'A')

ggsave(file = here("analysis/figures/example_sim_map.png"), plot = simplot, 
       width = 300, height = 76 + (76 * 2),
       units = "mm")

```

```{r example-2, echo = FALSE, fig.cap = "Example of a single simulation run on the site Hegna vest 1. A) The simulation starts by drawing a single year from the posterior density estimate.  B) This then corresponds to an elevation range on the interpolated displacement curve. A single elevation is drawn uniformly from this range using 5cm intervals. C) The sea-level is then adjusted on the DTM to this elevation and the various distance measures are found. D) The numerical result of the simulation run.", out.width = "500px", fig.align="center", regfloat=TRUE}
knitr::include_graphics(here("analysis/figures/example_sim_map.png"))
```

```{r example-site-cont3}
# Load simulation results
load(here("analysis/data/derived_data/hegnavest1.RData"))

dat1 <- datsamp <- ggplot(posteriorprobs) +
  ggridges::geom_ridgeline(aes(x = dates, y = name,
                               height = probabilities * 50),
                           fill = "lightgrey") +
  labs(x = "")  +
  theme_bw() + theme(
    legend.position = "none",
    axis.title.y = element_blank(),
    axis.ticks.y = element_blank()
  ) 

# Map of simulated sea-levels, date group 1
simsea_plot1 <- shore_plot(sitearea, output[[1]]$simsea, sitel, 150, date_groups,
                      s_tdist = 0.5, s_xpos = 1300, s_ypos = 800,
                      s_bheight = 0.3, s_tsize = 3)

# Boxplot of distances from site to sea, date group 1
simdist_plot1 <- distance_plot(output[[1]]$results)


# Retrieve date group 2
probsdat2 <- filter(datedat, group == 2 & class == "bposterior")

dat2 <- ggplot(probsdat2) +
  ggridges::geom_ridgeline(aes(x = dates, y = name,
                                   height = probabilities * 50,
                                   fill = as.factor(group),
                                   alpha = class,
                                   colour = as.factor(rcarb_cor))) +
  labs(x = "BCE")  +
  #scale_y_discrete(expand = c(0.01, 0)) +
  theme_bw() + theme(
    legend.position = "none",
    axis.title.y = element_blank(),
    axis.ticks.y = element_blank()
  ) +
      scale_colour_manual(breaks = c("f", "t", NA),
                         values = c("red", "black", "yellow")) +
      scale_alpha_manual(values = c("aprior" = 0.05,
                                    "bposterior" = 0.4,
                                    "sum" = 1)) +
  scale_fill_manual(
      values = as.character(ggthemes_data$colorblind[2, 2]))



# Plot of date group 2

# Map of simulated sea-levels, date group 2
simsea_plot2 <- shore_plot(sitearea, output[[2]]$simsea, sitel, 150, date_groups,
                      s_tdist = 0.5, s_xpos = 1300, s_ypos = 800,
                      s_bheight = 0.3, s_tsize = 3)

# Boxplot of distances from site to sea
simdist_plot2 <- distance_plot(output[[2]]$results)

simresultplot <- (dat1 + simsea_plot1 + simdist_plot1) /
(dat2 + simsea_plot2 + simdist_plot2) 

ggsave(file = here("analysis/figures/example_sim_result.png"),
       plot = simresultplot,  width = 250, height = 76 + (76 * 2),
       units = "mm")

```

```{r example-3, echo = FALSE, fig.cap = "The result of 1000 simulation runs for each of the two groups of dates on the site Hegna vest 1. The leftmost column of plots shows the calibrated radiocarbon probability distribution from where dates were drawn during simulation. The centre column displays the result of simulating the raised sea-level 1000 times. The more opaque the colour appears, the more times the sea-level was simulated in that location. The rightmost column shows violin plots of the different distance measures across all simulations.", out.width = "500px", regfloat=TRUE}
knitr::include_graphics(here("analysis/figures/example_sim_result.png"))
```

```{r distances}
distances2 <- distances %>%
  filter(year <= -2500 & rcarb_cor == "t" & type == "forager") %>% 
  mutate(hordist = ifelse(hordist < 0, 0, hordist),
         topodist = ifelse(topodist < 0, 0, topodist),
         vertdist = ifelse(vertdist < 0, 0, vertdist))

distances3 <- distances %>%
  filter(year <= -4000 & rcarb_cor == "t" & type == "forager") %>% 
  mutate(hordist = ifelse(hordist < 0, 0, hordist),
         topodist = ifelse(topodist < 0, 0, topodist),
         vertdist = ifelse(vertdist < 0, 0, vertdist))
```
# Simulation results

Overall, as is indicated by the measures for central tendency and the almost solid line along the 0m mark on the y-axes, the simulations show that the sites tend to have been situated close to the shoreline when they were in use (Figure \@ref(fig:results)). Some of the sites are situated considerable distances from the shoreline when the dates believed to be erroneous in the original reports are included (Figure \@ref(fig:results)A), but if one accepts the interpretation that these do not date the main occupation of the sites, as is indicated by the artefact inventories, Figure \@ref(fig:results)B gives considerable support to the notion that the sites were in use when they were situated on or close to the contemporaneous shoreline. The distances for some of the earliest sites appears somewhat high, but this can likely be explained as the result of the rapid RSL fall in the earliest part of the Holocene (Figure \@ref(fig:map-iso)B), which leads the uncertainty of the ^14^C-dates to give a wider possible elevation range for the simulated sea-level. Another immediately striking result is the apparent deviation from the shoreline towards the end of the Stone Age. After around 2500 BCE several sites are situated a considerable distance from the reconstructed shoreline, and while a couple remain horizontally and topographically close, most appear to be considerably elevated above the sea-level, as indicated on the plot for vertical distance. While the sample size is limited, there are also a couple of sites located some distance from the shoreline just after 4000 BCE. The chronological smearing following from the uncertainty in the ^14^C-dates means that while the results cannot be used to directly inform discussions that deal with the century scale around these chronological transitions [e.g.  @prescott2020; @solheim2021], the findings are nonetheless in clear agreement with the general chronological framework in the literature. 

The negative values around 8000 BCE originate from the sites Løvås 1, 2 and 3. These are recently excavated, well-dated sites situated in a relatively undisturbed area of the landscape [@reitan2022b]. While there could be a danger of circularity of having archaeological sites inform a reconstruction RSL-change, and, in turn, use these to evaluate the degree of shore-bound settlement, the sites do clearly represent an upper constraining limit for the sea-level, as they would not have been in use when located under water. It therefore seems that the Løvås sites represent a case where the archaeological material indicates a slight discrepancy in the geologic reconstruction of shoreline displacement in the area.

Accepting that shoreline dating appears to lose utility around the transition to the Late Neolithic, as indicated by the clear deviation in site location from the shoreline after this, the results from Figure \@ref(fig:results)B are presented again in Figure \@ref(fig:results2)A, excluding all simulation results younger than 2500 BCE. Furthermore, all negative values have here been set to zero, under the assumption that these result from uncertainty or errors in the data, and not actual site locations. The resulting best point estimate for the vertical distance between sites and shoreline for the pre-Late Neolithic is given by the median distance of `r round(median(distances2$vertdist))`m, while 95% of the values fall within the range `r round(quantile(distances2$vertdist, 0))`--`r round(quantile(distances2$vertdist, 0.95))`m. That is, for 95% of the cases, the shoreline was simulated to be situated on or lower than `r round(quantile(distances2$vertdist, 0.95))`m below the site location. While these values remain the same when only the Mesolithic dates are included (Figure \@ref(fig:results2)B), the mean and standard deviation are slightly constrained. Furthermore, while the median for horizontal and topographic distance is only `r round(median(distances2$topodist))`m across all plots in Figure \@ref(fig:results2), the variation in the statistics for dispersion is greater, illustrating the point that minor variations in vertical distance can have substantial consequences for these distance measures, depending on the surrounding topography.

```{r agediffdat}
# Preparing some data for the text

# Subtract one for Gunnarsrød 5 (see text)
synchdata$meso[synchdata$cross == "false"] <- 
  synchdata$meso[synchdata$cross == "false"] - 1

cormeso <- synchdata %>% dplyr::filter(cross == "true") %>% 
  dplyr::select(meso)
corpreln <-  synchdata %>% dplyr::filter(cross == "true") %>% 
  dplyr::select(pre_ln)
corln <-  synchdata %>% filter(cross == "true") %>% dplyr::select(ln)
phasesums <- summarise_if(synchdata, is.numeric, sum, na.rm = TRUE)

```

```{r results, echo = FALSE, fig.cap = "The result of running the analysis across all sites. Each data point is plotted with some transparency, meaning that the more intense the colour, the more often those values occurred. Results associated with agricultural activites are plotted in grey. The first row A) shows the result of including all dates to the Stone Age, including those seen as otherwise  unrelated to the main occupation of the sites. The second row B) shows the result of excluding these. The table under each plot lists some corresponding statistics for central tendency and dispersion.", out.width = "500px", fig.align="center", regfloat=TRUE}
knitr::include_graphics(here("analysis/figures/results.png"))

```

```{r results2, echo = FALSE, fig.cap = "Histograms showing the simulated distance from the shoreline using radiocarbon dates corresponding to the site inventories. Negative values have been set to zero. A) Simulated results older than 2500 BCE, and B) simulated results older than 4000 BCE.", out.width = "525px", fig.align="center", regfloat=TRUE}
knitr::include_graphics(here("analysis/figures/results2.png"))
```

An exponential function has been fit to the distributions for vertical distance using maximum likelihood estimation (Figure \@ref(fig:results2)). While it makes theoretical sense that a process of exponential decay explains this relationship, it is also clear that this does not perfectly match the data. However, this can at least in part be related to methodological factors, where the accumulation of distance-values on the 0m mark likely follow from forcing negative values to zero, from the resolution of the spatial data, and from defining intersecting sea- and site polygon as having a zero distance. If one accepts this, the probability density function for exponential decay can be used to characterise the vertical distance between sites and the shoreline and be used to inform a method for shoreline dating that takes this into account.

# Shoreline dating

The procedure for shoreline dating to be outlined is aimed at determining the likely age of the occupation of a site based on its altitude above present day sea-level, with reference to shoreline displacement and the likely elevation of the site above the sea-level when it was in use. For simplicity, this is conceptually treated a single event and thus the possibility of multiple or continuous phases of occupation is not treated explicitly. This leads the problem to become similar to that of the calibration of a radiocarbon date [see Figure \@ref(fig:exampledat), @bronkramsey2009; @stuvier1989; @vanderplicht1993]. First, finding the elevation of the sea-level at the time the site was in use is dependent on the present day elevation of the site $\alpha$ and the distance between site and the shoreline $D$. Based on the simulation results above, the distance from the elevation of the site to the contemporaneous shoreline is defined by the probability density function for exponential decay:

<!-- d = 1(1-\lambda)x -->
\begin{equation}
  p(\alpha - D) = \lambda {e}^{- \lambda (\alpha - D)}
  (\#eq:decay)
\end{equation}

where $\lambda$ is the decay ratio. This can then be coupled with the trajectory of relative sea-level change to find the corresponding calendar date $T$ for the occupation of the site. This is defined by a uniform probability density function ($U$) over the range between the lower $T_{l}$ and upper $T_{u}$ bounds of the displacement curve that has been interpolated to the site location: 

\begin{equation}
p(T | \alpha - D) = U[T_{l | \alpha - D}, T_{u | \alpha - D}]	
  (\#eq:rsl)
\end{equation}

Finding the probability for the date of the site then becomes a matter of transferring the probability of the distance between site and shoreline to calendar dates using the displacement curve:

\begin{equation}
p(T | \alpha - D) = p(T | \alpha - D)p(\alpha - D)
  (\#eq:comb)
\end{equation}

We can then get rid of parameter $D$ by summing all possible distances between site and the shoreline. Given its elevation, the probability for the date of the occupation of a site is then:

<!-- p\left(t\right) = \binom{x}{x} x^x\left(x-x\right)^{x-x} -->
\begin{equation} 
  p(T | \alpha) = \sum_{D} p(T | \alpha - D)p(\alpha - D)
  (\#eq:shoredate)
\end{equation} 

An example of an implementation of the outlined approach is given in Figure \@ref(fig:exampledat), where $\lambda$ = `r round(expfit$estimate, 3)`. This is the decay ratio identified when considering all pre-Late Neolithic simulation results (Figure \@ref(fig:results2)A). For the numerical implementation, $D$ is here stepped through as a sequence of increments of 0.001m, starting from the site elevation $\alpha$. The exponential function is stepped through in it's cumulative form, where the probability from the previous 0.001m step is subtracted from the probability at the current step. This probability is then divided equally across the individual calendar years in the range between the lower and the upper limit of the displacement curve at the current 0.001m step. The histogram that is the resulting shoreline date is the sum of performing this procedure on all possible 0.001m values of $D$, which, in practice, is until $\alpha - D = 0$ or when 99.999% of the exponential function has been stepped through.   

To evaluate the outlined procedure it is used to shoreline date the sites from where the method was derived to check if the resulting shoreline dates correspond to the radiocarbon dates associated with the sites (Figure \@ref(fig:shoredate)). The Late Neolithic sites are also included here for illustrative purposes, even though these have not informed the decay ratio in use. Following from having defined the distance between intersecting sea- and site polygons as zero during simulations, the sites were dated using the mean elevation of the site polygons to allow for some variation in elevation over the site limits. The synchroneity between radiocarbon and shoreline dates was then evaluated using the method presented by @parnell2008. Here, 100,000 age samples drawn from the probability distribution of each shoreline date were subtracted from 100,000 age samples drawn from the corresponding modelled ^14^C-dates. The resulting range of the 95% highest density region [HDR, @hyndman1996] was then checked to see if it crosses zero, in which case the dates are considered to be in agreement (Figure \@ref(fig:shoredatediff)). When excluding the earliest occupation phase at Gunnarsrød 5, the deviation of which is to be expected based on issues with the DTM (see above), the shoreline date corresponds to the radiocarbon dates in `r synchdata[synchdata$cross == "true", "row_total"]` out of `r sum(synchdata$row_total)-1` cases (`r round(synchdata[synchdata$cross == "true", "row_total"]/sum(synchdata$row_total)*100)`%). Only including dates modelled to be older than 2500 BCE with 95% probability, i.e. older than the Late Neolithic, improves this to `r cormeso + corpreln` out of `r phasesums["meso"] + phasesums["pre_ln"]` cases (`r round((cormeso + corpreln)  / (phasesums["meso"] + phasesums["pre_ln"])*100)`%). When only including dates older than 4000 BCE with 95% probability, i.e. only Mesolithic site phases, the success rate is further increased to `r cormeso`/`r phasesums["meso"]` (`r round(cormeso/phasesums["meso"]*100)`%). The three failed Mesolithic shoreline dates are from the early sites Langemyr and Kvastad A2, with the likely implication that a lower decay ratio than what is used for characterising the distance between site and shoreline for all sites in aggregate should be used for sites known to be from the earliest part of the Mesolithic (see also Figure \@ref(fig:results)).

```{r exampledat, echo = FALSE, fig.cap = "Shoreline dating of Hegna vest 1. The dashed line marks the mean elevation of the site polygon which is used to inform $\\alpha$ in the dating of the site. The exponential function decays with ratio $\\lambda$ from Figure 7A. The resulting shoreline date in grey is underlined with the 95\\% HDR in black.", out.width = "500px", fig.align="center", regfloat=TRUE}
knitr::include_graphics(here("analysis/figures/sdate.png"))

```

```{r shoredate, echo = FALSE, fig.cap = "The result of backwards shoreline dating the sites with radiocarbon dates corresponding to the artefact inventory using the method proposed here. The shoreline dates are plotted in grey and underlined with the 95\\% HDR in black. These are plotted against the modelled radiocarbon dates, which are given colour from oldest to youngest occupation phase for each site, defined by non-intersecting dates at 99.7\\% probability.", out.width = "525px", fig.align="center", regfloat=TRUE}
knitr::include_graphics(here("analysis/figures/shoredate.png"))
```

```{r shoredatediff, echo = FALSE, fig.cap = "Evaluation of the agreement between the shoreline dates and radiocarbon dates given in Figure 9. When the range of the 95\\% HDR for age difference crosses zero, the shoreline and radiocarbon dates are considered to be in agreement. Line segments with vertical bars indicate that the HDR does not cross zero and that the dates do not correspond.  The division and colour coding at the top of the plots reflect the division of site phases given in Figure 9.", out.width = "525px", fig.align="center", regfloat=TRUE}
knitr::include_graphics(here("analysis/figures/shoredate2.png"))
```


# Re-dating previously shoreline dated sites

To further explore the implementation for shoreline dating presented above, excavated and shoreline dated Stone Age sites within the study area where ^14^C-dates are not available or these are not believed to date the main occupation of the sites have been subjected to the outlined approach (Figure \@ref(fig:redate)). The resulting dates are compared to those originally proposed in the excavation reports for the sites (the numerical results are available in the supplementary material). To avoid issues with recent disturbances on the DTM, the sites have been dated based on the mean of the altitudes provided in the report for each site. As all of the included sites have been excavated after the turn of the millennium, and the wide adoption of GNSS technology, the reported elevations should be trustworthy.

The comparison with previously reported dates is an illustrative, but unfair exercise for a few reasons. First, the dates provided in the reports are typically stated to be a very rough estimate, and are sometimes given as a point estimate with an undefined, but implied or explicit uncertainty range. Secondly, seeing as these reports are from various dates in time, many are based on now outdated data on RSL-change. Finally, they are sometimes only meant to indicate a lower bound for when the sites could have been in use. Overall, the results could, with some danger of circularity, suggest that shoreline dating has generally been applied with a reasonable degree of success, seeing as these dates have typically been interpreted and informed research in an approximate manner [although see e.g. @roalkvam2022]. With these considerations in mind, the results also indicate that shoreline dating has at times been applied with an exaggerated degree of precision. While the implications of a more stable RSL-change for shoreline dating are well known, this also appears to be somewhat under-appreciated in the practical implementation of the method. The results also highlight the spatial and temporal contingency of the method, illustrated by the variation in the range of the 95% HDRs for the dates. In some cases the method provides a very precise date range and in others it offers little more than a *terminus post quem*. This is dependent on the steepness of the displacement curves, leading to the general pattern of older sites situated towards the north-east getting more precise dates (cf. Figure \@ref(fig:map-iso)B). Furthermore, as some of the date ranges extend well beyond major chronological divisions, even into the Iron Age, they could be severely and securely constrained with only cursory reference to typology. While this would be trivial in some cases, the nature and uncertainty inherent to the method still means that this is arguably a required exercise that should be explicitly performed. This also points to the possibility of drawing on other temporal data, for example within a Bayesian framework, to further improve the precision of the dates that can be achieved with shoreline dating. 


```{r redate, echo = FALSE, fig.cap = "Re-dating excavated and previously shoreline dated sites in the study area without radiocarbon dates or with radiocarbon dates that do not correspond to the artefact inventories. The 95\\% HDRs in grey are compared to the dates originally proposed by the excavation reports in red.", out.width = "525px", fig.align="center", regfloat=TRUE}
knitr::include_graphics(here("analysis/figures/redate.png"))
```

Not least following from the fact that relatively few ^14^C-dates older than c. 8000 BCE associated with anthropogenic activity have been achieved in Norway [@åstveit2018; @damlien2018b; @kleppe2018], the shoreline dating of the earliest sites is essential for understanding the pioneer settlement and the initial colonisation of the Scandinavian peninsula [e.g. @bang-andersen2012; @berg-hansen2018; @breivik2014; @glorstad2016; @fuglestvedt2012]. The shoreline dated Preboreal sites from the Brunlanes-project are among the earliest known sites in Norway [@jaksland2014a; @jaksland2012; @jaksland2012a]. These have a distinct Early Mesolithic artefact inventory and are situated in a steep area of the landscape where use of the sites would have been difficult after the sea retreated any significant distance from their location due to accessibility. In the original publication of the sites, @jaksland2014 provides a thorough discussion of shoreline dating in general, and as used for the dating of the Brunlanes sites specifically. A comparison of his results and the ones achieved using the above-outlined approach are given in Figure \@ref(fig:brunlanes)A. The sites have been dated using what @jaksland2014 gives as the lowest elevation of finds at each site, and by employing a exponential decay ratio of `r round(expfit3$estimate, 3)`, to allow for more deviance in the distance between site and shoreline. This corresponds to the decay ratio for results older than 7000 BCE in Figure \@ref(fig:results2).  

The small discrepancies between the achieved results mainly follow from the fact that a slightly updated version of the local displacement curve is applied here [cf. @sørensen2014; @sorensen2023]. Jaksland's dates are given a flat 200- and 50-year uncertainty range starting from what he gives as the earliest possible date. The 200 year uncertainty range is given if the sites were to be considered in isolation, while his argument for the uncertainty range of only 50 years is based on the location of the sites relative to each other. Since they are located in such a constrained and steep area of the landscape, the difference in elevation between the sites is argued to establish their relative date and thus constrain the uncertainty ranges so that they do not overlap. This information is not integrated in the approach outlined here, but it could justify further reducing the uncertainty ranges. 

Although their accuracy is of course ultimately dependent on the veracity of the geological reconstruction, the high rate of RSL-change in this period does result in very precise dates. Above it was suggested that additional temporal data could be combined with the method to improve its accuracy and precision. Drawing on @jaksland2014, this example instead highlights the fact that the spatial nature of the method means that a consideration of the surrounding terrain and other sites can also help to increase the precision of the method if this can be used to exclude certain RSLs as unlikely for when a site was in use. One approach could also be to assess the spatial implication of a proposed shoreline date by simulating the adjusted sea-levels, as is done for Pauler 1 in Figure \@ref(fig:brunlanes)B, followed for example by a visual evaluation of the topography or by evaluating the distance and steepness of the slope to the shoreline. If this method is developed further, it could conceivably be possible to exclude certain elevations as unlikely for the position of the shoreline when the site was in use. Such approaches would make less of an impact in this setting, where the 95% HDR is already quite constrained, but could considerably improve the precision of the method in cases where RSL-change has been less severe (cf. Figure \@ref(fig:redate)).

```{r brunlanes, echo = FALSE, fig.cap = "Shoreline dating of the Brunlanes sites using site altitudes provided by Jaksland (2014:tab.4). A) The result of applying the approach to shoreline dating outlined above. The shoreline date in grey is underlined with the 95\\% HDR in black. Dates provided by Jaksland (2014) are plotted in red. The box indicates a 50 year uncertainty range which in combination with the red line extends 200 years. B) Map showing the centroids of the Pauler sites and Sky 1. The sea-level has been simulated using the probability distribution associated with the shoreline date for Pauler 1 (see also map in Jaksland 2014:fig.12a). Pauler 1 is the red point.", out.width = "525px", fig.align="center", regfloat=TRUE}
knitr::include_graphics(here("analysis/figures/brunlanes.png"))
```


# Concluding remarks

The most significant finding of this paper is a confirmation of previous research into the relation between coastal Norwegian Stone Age sites and the prehistoric shoreline. This is indicated by the close proximity of sites and the shoreline until the transition to the Neolithic at c. 4000 BCE, after which a few sites are situated some distance from the sea, followed by a more decisive break at the transition to the Late Neolithic at c. 2500 BCE. This development is in clear agreement with the literature. Furthermore, based on the quantitative nature of these findings, an initial formulation of a refined method for the shoreline dating of pre-Late Neolithic Stone Age sites has been proposed. Apart from taking the distance between sites and the isobases of the displacement curves into consideration when dating the sites, this involves accounting for the distance between the sites and the shoreline. When no other information is available, it can at present be recommended to use the empirically derived exponential decay ratio of `r round(expfit$estimate, 3)` (Figure \@ref(fig:results2)A) to characterise this relationship. Furthermore, while this remains to be formalised and explored further, it was also showed how the method can be improved by including more information, both with reference to the topographic location of the sites and other temporal data. As the precision of the method is both geographically and temporally contingent due to the trajectory of RSL-change, where older sites situated towards the north-east in the study area will get a more precise date, the impact of such additional information will also vary.

Future investigations and radiocarbon dates from Stone Age sites in the region can not only be used to further evaluate and adjust the findings reported here, but a larger sample size could also lay the foundations for refining the method by identifying subsets of sites for which the application of the method could be adjusted. Given its behavioural nature, it would for example seem likely that dimensions such as the nature and purpose of visits to the sites will have implications for how close to the shoreline they were located. Furthermore, other dimensions related to the topographic location of the sites could be similarly explored. This for example pertains to the exposure of sites to wave action, which is likely to have been of concern [@roalkvam2020], and which presumably has implications for how close to the shoreline people settled [@helskog1978; @blankholm2020]. This is also related to the fact that while the mean sea-level is used for dating the sites, a consideration of the tidal range could possibly also have implications for the site location relative to the shoreline, depending on the topography [@helskog1978]. The potential of exploring dimensions such as these was also hinted at here with the estimation and cursory treatment of the horizontal and topographic distance to the shoreline. If patterns related to such locational patterns can be discerned and unpacked, this will not least be useful for improving the shoreline dating of sites which have only been surveyed and where little information beyond their location is available.

Some limitations and sources of likely variation and uncertainty that have not been considered should also be mentioned. First, the sample size is limited and the future addition of more sites might alter the picture considerably. Secondly, the validity of the outlined method was evaluated by applying it to the data from where the input parameters were derived. Fitting and evaluating a model using the exact same data will likely exaggerate its performance. Thirdly, the DTM has only been corrected for major modern disturbances. This means that other forms of erosion, although likely not that prevalent, have not been considered. Fourthly, the DTM has a vertical error which could also benefit from being integrated in the analysis [@fisher1993; @lewis2021]. Fifthly, the displacement curves were here interpolated to all site locations without accounting for increased uncertainty as one moves further away from the isobases of the displacement curves---an uncertainty that is likely higher for RSL-change further back in time due to the shoreline gradient. This is also related to the fact that the geologic reconstructions hold uncertainty that is not represented in the displacement curves, relating for example to variation in the methods and quality of the data used for the compilation of the curves, as well as the expert interpretations underlying these. Sixthly, neither the question of how site limits are defined nor the elevation range over which these extend was given much consideration [@mjærum2022]. Finally, the aggregation and division of settlement phases at each site was here simply done by treating radiocarbon dates not overlapping at 99.7% as representing unrelated occupation events. This could also be handled differently [e.g. @bronkramsey2009; @bronkramsey2015]. While each of these factors will have variable impact on the final results, they clearly represent dimensions which would all benefit from further consideration and which means that some of the precision following from the outlined approach is likely to be spurious. 

Given that shoreline dating is contingent on regular patterns of human behaviour it should naturally be applied with care. Furthermore, formulating and visualising the method along the lines of how radiocarbon dates are treated, as was done here, does stand the chance of giving a veneer of radiometric accuracy to shoreline dating that is not warranted. That being said, the best chance we have of not throwing away precious temporal data, or exaggerating our handle on it, is arguably to rigorously evaluate the method using independent data such as radiocarbon dates, by offering a precise formulation of how it could be applied, by specifying what sources of uncertainty are accounted for and by making this process transparent through the open dissemination of underlying data and programming code.

Finally, this analysis employed a simulation approach to integrate multiple sources of spatio-temporal uncertainty. Here this was simply used to inform the question of the distance between sites and the shoreline. However, this method and general framework can be extended to a wide range of use-cases where one needs to visualise, and quantitatively or qualitatively evaluate the relationship between archaeological phenomena, the prehistoric shoreline, and the uncertainty inherent to this reconstruction.

\newpage

# References

::: {#refs}
:::
